# Distributed Arithmetic Calculator

Содержание:

1. [Структура проекта](#Структура-проекта)
2. [Установка и запуск](#Установка-и-запуск)
3. [API](#API)
4. [Примеры использования](#Примеры-использования)
5. [Возможные ошибки](#Возможные-ошибки)


Этот проект реализует распределённый вычислитель арифметических выражений. Он состоит из двух основных компонентов:

1. **Оркестратор**: Сервер, который принимает арифметическое выражение, переводит его в набор последовательных задач и обеспечивает порядок их выполнения.
2. **Агент**: Демон, который получает задачи от оркестратора, выполняет их и отправляет результаты обратно на сервер.

Каждая операция (сложение, вычитание, умножение, деление) имеет своё время выполнения которое задаётся в переменных среды (в файле .env). Поэтому запускать оркестратора и агента нужно ИМЕННО ТАК КАК ПОКАЗАНО В ИНСТРУКЦИИ. Также в переменных среды задаётся колличество горутин-агентов которые будут работать одновременно.

## Структура проекта

- `agent/` - Код агента.
  - `cmd/agent/` - Точка входа для запуска агента.
  - `internal/app/` - Логика работы агента.
- `orchestrator/` - Код оркестратора.
  - `cmd/calc-service/` - Точка входа для запуска оркестратора.
  - `http/server/handler/` - Обработчики HTTP-запросов.
  - `grpc/server/` - gRPC сервер для отправки и получения даных для и от агента
  - `internal/app/` - Логика обработки выражений.
  - `models/` - Определения структур данных.
- `proto` - все необходимое для работы gRPC
- `.env` - Файл для хранения переменных среды.
- `docker-compose.yml` - докер компуз
- `go.mod` 
- `go.sum`
- `README.MD` - хз зачем он нужен

## Установка и запуск

### Предварительные требования

- Docker

### Установка

Запустить можно только с помощью docker compose

**Вообще docker hub не давно заблокировали в России поэтому перед запуском включите VPN или используйте другое зеркало.**

Скопируйте репозиторий и запустите с помощью docker compose:
```sh
docker compose up
```

## API
### Оркестратор
1. Добавление вычисления арифметического выражения
```sh
curl --location 'localhost:8080/api/v1/calculate' \
--header 'Content-Type: application/json' \
--data '{
      "id": "<уникальный идентификатор выражения>",
      "expression": "<строка с выражением>"
}'
```

2. Получение списка выражений
```sh
curl --location 'localhost:8080/api/v1/expressions'
```

3. Получение выражения по его идентификатору
```sh
curl --location 'localhost:8080/api/v1/expressions/<id выражения>'
```

### Агент
Общается с оркестратором по gRPC.

## Примеры использования 
1. Добавление вычисления арифметического выражения
```sh
curl --location 'localhost:8080/api/v1/calculate' \
--header 'Content-Type: application/json' \
--data '{
      "id": "1",
      "expression": "2 + 2 * 2"
}'
```

2. Получение списка выражений
```sh
curl --location 'localhost:8080/api/v1/expressions'
```
Вывод:
```json
{"expressions":[{"id":"1","expression":"2 + 2 * 2","status":"completed","result":6}]}
```

3. Получение выражения по его идентификатору
```sh
curl --location 'localhost:8080/api/v1/expressions/1'
```
Вывод:
```json
{"expression":{"id":"1","expression":"2 + 2 * 2","status":"completed","result":6}}
```